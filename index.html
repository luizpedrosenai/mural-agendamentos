<!DOCTYPE html>
<html>
<head>
    <title>Agendamento de Salas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .agendamento { border: 1px solid #ccc; padding: 10px; margin: 5px; }
        button { margin: 5px; padding: 8px 15px; }
        input, select { margin: 5px; padding: 8px; }
        #debug { background: #f5f5f5; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Agendamento de Salas</h1>
    
    <!-- √Årea de Debug -->
    <div id="debug">
        <h3>üîç Debug Info</h3>
        <div id="debugInfo">Carregando...</div>
    </div>

    <div>
        <h2>Novo Agendamento</h2>
        <input type="text" id="sala" placeholder="Sala">
        <input type="text" id="professor" placeholder="Professor">
        <input type="datetime-local" id="inicio">
        <input type="datetime-local" id="fim">
        <button onclick="adicionarAgendamento()">Adicionar</button>
    </div>

    <div id="agendamentos">
        <h2>Agendamentos Existentes</h2>
    </div>

    <script>
        // ‚ö†Ô∏è SUBSTITUA PELA SUA URL REAL!
        const API_URL = "https://script.google.com/macros/s/SEU_SCRIPT_ID/exec";

        // Debug function
        function debug(message) {
            console.log("üîç DEBUG:", message);
            document.getElementById('debugInfo').innerHTML += message + "<br>";
        }

        // Carregar agendamentos ao iniciar
        document.addEventListener('DOMContentLoaded', function() {
            debug("P√°gina carregada - iniciando...");
            carregarAgendamentos();
        });

        async function carregarAgendamentos() {
            debug("Tentando carregar agendamentos...");
            debug("URL da API: " + API_URL);
            
            try {
                debug("Fazendo requisi√ß√£o GET...");
                const response = await fetch(API_URL);
                debug(`Status da resposta: ${response.status}`);
                debug(`URL final: ${response.url}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                debug(`Resposta recebida: ${text.substring(0, 100)}...`);
                
                const agendamentos = JSON.parse(text);
                debug(`‚úÖ ${agendamentos.length} agendamentos carregados`);
                
                const container = document.getElementById('agendamentos');
                container.innerHTML = '<h2>Agendamentos Existentes</h2>';
                
                if (agendamentos.length === 0) {
                    container.innerHTML += '<p>Nenhum agendamento encontrado.</p>';
                }
                
                agendamentos.forEach(ag => {
                    const div = document.createElement('div');
                    div.className = 'agendamento';
                    div.innerHTML = `
                        <strong>Sala:</strong> ${ag.sala} | 
                        <strong>Professor:</strong> ${ag.professor} | 
                        <strong>In√≠cio:</strong> ${ag.inicio} | 
                        <strong>Fim:</strong> ${ag.fim}
                        <button onclick="deletarAgendamento(${ag.id})">Deletar</button>
                    `;
                    container.appendChild(div);
                });
                
            } catch (error) {
                debug(`‚ùå ERRO: ${error.message}`);
                console.error('Erro completo:', error);
                
                const container = document.getElementById('agendamentos');
                container.innerHTML = `
                    <h2>Erro ao Carregar Agendamentos</h2>
                    <p><strong>Erro:</strong> ${error.message}</p>
                    <p>Verifique: 
                        <br>1. Se a URL da API est√° correta
                        <br>2. Se o Apps Script foi implantado corretamente
                        <br>3. O console do navegador para mais detalhes
                    </p>
                `;
            }
        }

        async function adicionarAgendamento() {
            const sala = document.getElementById('sala').value;
            const professor = document.getElementById('professor').value;
            const inicio = document.getElementById('inicio').value;
            const fim = document.getElementById('fim').value;

            if (!sala || !professor || !inicio || !fim) {
                alert('Preencha todos os campos!');
                return;
            }

            debug("Tentando adicionar agendamento...");

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: "add",
                        sala: sala,
                        professor: professor,
                        inicio: inicio,
                        fim: fim
                    })
                });

                const text = await response.text();
                debug(`Resposta POST: ${text}`);
                
                const resultado = JSON.parse(text);
                if (resultado.status === "sucesso") {
                    alert('‚úÖ Agendamento adicionado!');
                    carregarAgendamentos();
                    // Limpar campos
                    document.getElementById('sala').value = '';
                    document.getElementById('professor').value = '';
                    document.getElementById('inicio').value = '';
                    document.getElementById('fim').value = '';
                }
            } catch (error) {
                debug(`‚ùå ERRO POST: ${error.message}`);
                alert('Erro ao adicionar agendamento.');
            }
        }

        async function deletarAgendamento(id) {
            if (!confirm('Tem certeza que deseja deletar este agendamento?')) return;

            debug(`Tentando deletar agendamento ID: ${id}`);

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        acao: "delete",
                        id: id
                    })
                });

                const resultado = await response.json();
                if (resultado.status === "sucesso") {
                    alert('‚úÖ Agendamento deletado!');
                    carregarAgendamentos();
                }
            } catch (error) {
                debug(`‚ùå ERRO DELETE: ${error.message}`);
                alert('Erro ao deletar agendamento.');
            }
        }
    </script>
</body>
</html>
