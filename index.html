function doGet(e) {
  try {
    var ss = SpreadsheetApp.openById("1EMt_TECPbkYBtQM1_SVu2P-fa-Og9rynwoL2HdHSbAs");
    var sheet = ss.getSheets()[0];
    var data = sheet.getDataRange().getValues();
    
    var response = {
      status: "success",
      message: "Conex√£o estabelecida com a planilha!",
      data: data,
      timestamp: new Date().toISOString()
    };
    
    return ContentService.createTextOutput(JSON.stringify(response))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeaders({
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
        'Access-Control-Allow-Headers': 'Content-Type'
      });
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      status: "error",
      message: error.toString(),
      timestamp: new Date().toISOString()
    }))
    .setMimeType(ContentService.MimeType.JSON)
    .setHeaders({
      'Access-Control-Allow-Origin': '*'
    });
  }
}

function doPost(e) {
  try {
    var ss = SpreadsheetApp.openById("1EMt_TECPbkYBtQM1_SVu2P-fa-Og9rynwoL2HdHSbAs");
    var sheet = ss.getSheets()[0];
    
    // Parse the JSON data from the request
    var dados = JSON.parse(e.postData.contents);
    
    // Append a new row with the data
    sheet.appendRow([dados.sala, dados.professor, dados.inicio, dados.fim]);
    
    var response = {
      status: "success",
      message: "Agendamento salvo com sucesso!",
      timestamp: new Date().toISOString()
    };
    
    return ContentService.createTextOutput(JSON.stringify(response))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeaders({
        'Access-Control-Allow-Origin': '*',
        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
        'Access-Control-Allow-Headers': 'Content-Type'
      });
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      status: "error",
      message: error.toString(),
      timestamp: new Date().toISOString()
    }))
    .setMimeType(ContentService.MimeType.JSON)
    .setHeaders({
      'Access-Control-Allow-Origin': '*'
    });
  }
}
